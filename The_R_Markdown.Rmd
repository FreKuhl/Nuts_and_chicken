---
title: "Nuts and chicken"
author: "Lukas Gürtler & Frederik Kuhl"
output: html_document
bibliography: 
  - bib/references.bib 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(decisionSupport)
library(tidyverse)
library(knitr)
library(readxl)
library(rmarkdown)
```

```{r add_R_bib, include=FALSE}
knitr::write_bib(c(.packages(),
                   'knitr', 'decisionSupport'), 'bib/packages.bib')
```

This supplementary is available under <https://github.com/FreKuhl/Nuts_and_chicken.git> and outlines the Decision Analysis approaches used in Model-based evaluation of management options in ornamental plant nurseries [@ruett_model-based_2020]. Here we provide our input table, code and results to allow for transparent reproduction of the model.

All other applied `R` packages are cited and listed in the [References].

## Input table
The input table `Input_estimates.xlsx` (attached) contains: Variable names, unit, distributions (posnorm = positive normal distribution, const = constant, tnorm_0_1= truncated normal distribution, norm = normal distribution), lower bound, mean, upper bound and definition of variables.

## Implementing the model in R

Here we provide our mathematical model that enables simulation of decision outcomes.
The calculations in this document are based on random draws from the distributions in the input table `Input_estimates.csv`. Explanations for code chunks are not part of the actual simulation. 

Load the input table `Input_file.csv` and make variables.
```{r eval= FALSE}
input_estimates <- read_excel("input_estimates.xlsx")

make_variables <- function(est,n=1)
{ x <- random(rho=est, n=n)
for(i in colnames(x)) assign(i, as.numeric(x[1,i]),envir = .GlobalEnv)}

make_variables(as.estimate(input_estimates))
```

We generated a function called `model_function` to evaluate the decision options in `decisionSupport` [@luedelingDecisionSupportQuantitativeSupport2019]. The following calculations are part of this function (see the entire function below). 
```{r eval= FALSE}
model_function <- function() {}
```

We used the `vv()` (value varier function) function from `decisionSupport` [@luedelingDecisionSupportQuantitativeSupport2019] to account for the monthly variation in infection risks.
Here it is used to generate values out of variables pre-defined upper and lower bounds over time.

# Results

## Explaining Results/Values

Running the model produces a different outputs who are defined in the return list of the `model_function`. In this case it includes the accumulated income values for each scenario for the whole time-period, a vector with annual distribution of income for each scenario as well as different calculated decisions. Additionally the amount of sequestered CO2 is considered as an output.
The raw model-results of each scenario, including the baseline, is shown in the Graph 1. 
On the X-Axis the possible revenue distribution in € is displayed. The Y-Axis displays the probability density how likely one certain amount of revenue is likely. If the Curve for a scenario is wide, it means that the the degree of uncertainty is high, the possible revenue range is large. The smaller the curve is, the scenario is more defined and it is of a higher certainty that the displayed revenue is reached.
The baseline has the smallest curve, which means that this base-scenario is, compared to the other scenarios, well defined. This is because normal crop land is a well known and researched system with comparable few components who affect the income. The more aspects are added to a system, the uncertainty adds up and the distribution curve grows. Also single components with a high uncertainty, such as the truffles, add uncertainty to the whole system. This is also visible in Graph 1, the systems including nuts, chicken and truffle have the widest distribution curve. The very left side of a curve is the chance of getting always the worst part of the range of every input factor. If the  ranges for the input factors are chosen right, this is the point of the lowest possible income or highest possible loss. The very right side is the opposite, always the best part of the range of the input factors occur. So its the maximal possible revenue.
Based on the Curves for every scenario, different decisions can be modeled and conclusions can be drawn. The `decisionSupport` [@luedelingDecisionSupportQuantitativeSupport2019] Package also allows provides additional in depth analysis tools. They were also used for the evaluation of the results in this chapter.

## In depth analysis

Graph 1 shows that most likely every scenario will produse a positive overall income over a period of 30 years. Even so with every scenario there is also a chance of producing an overall loss. The current status of the area of interest is conventional crop land, this is the baseline. In order to determine wether or not one of the five agroforestry scenarios will be more profitable compared to the baseline, the baseline is in Graph 2 substracted from each of the five scenarios. Graph 2 is therefor no longer just presenting the distribution of income but its presenting how much the decision of switching from the baseline to one of the scenarios is worth. 

## Conclusions

### Improvements

# References